<% content_for :title, "設定 - #{blog_title}" %>

<!-- ブログ風設定ページ -->
<div class="max-w-2xl mx-auto">
  <!-- 設定ページヘッダー -->
  <header class="mb-12 text-center">
    <h1 class="text-2xl text-gray-900" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 300;">
      設定
    </h1>
  </header>

  <!-- 設定フォーム -->
  <%= form_with url: config_path, method: :patch, local: true, class: "space-y-8", onsubmit: "return true" do |form| %>
    
    <!-- インスタンス情報セクション -->
    <section>
      <h2 class="text-lg text-gray-900 mb-4" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 400;">
        インスタンス情報
      </h2>
      
      <div class="space-y-4">
        <div>
          <%= form.label "config[instance_name]", "インスタンス名", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.text_field "config[instance_name]", 
              value: @config[:instance_name],
              placeholder: "インスタンス名（ブログタイトル）",
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
        </div>

        <div>
          <%= form.label "config[instance_description]", "説明", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.text_area "config[instance_description]", 
              value: @config[:instance_description],
              placeholder: "インスタンスの説明",
              rows: 3,
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors resize-none",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
        </div>

        <div>
          <%= form.label "config[instance_contact_email]", "連絡先メール", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.email_field "config[instance_contact_email]", 
              value: @config[:instance_contact_email],
              placeholder: "contact@example.com",
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
        </div>

        <div>
          <%= form.label "config[instance_maintainer]", "管理者名", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.text_field "config[instance_maintainer]", 
              value: @config[:instance_maintainer],
              placeholder: "管理者名",
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
        </div>

        <div>
          <%= form.label "config[blog_footer]", "フッター", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.text_field "config[blog_footer]", 
              value: @config[:blog_footer],
              placeholder: "フッターに表示するテキスト",
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
        </div>

      </div>
    </section>

    <!-- ユーザープロフィールセクション -->
    <section>
      <h2 class="text-lg text-gray-900 mb-4" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 400;">
        プロフィール設定
      </h2>
      
      <div class="space-y-4">
        <div>
          <%= form.label "actor[summary]", "自己紹介", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <%= form.text_area "actor[summary]", 
              value: current_user&.summary,
              placeholder: "あなたの自己紹介を入力してください",
              rows: 4,
              class: "w-full px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors resize-none",
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <p class="text-xs text-gray-500 mt-1" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 300;">
            https://から始まるURLは自動的にリンクになります
          </p>
        </div>
      </div>
    </section>

    <!-- デザインセクション -->
    <section>
      <h2 class="text-lg text-gray-900 mb-4" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 400;">
        デザイン設定
      </h2>
      
      <div class="space-y-4">
        <div>
          <%= form.label "config[background_color]", "背景色", 
              class: "block text-sm text-gray-700 mb-2", 
              style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" %>
          <div class="flex items-center space-x-3">
            <%= form.text_field "config[background_color]", 
                value: @config[:background_color],
                placeholder: "#fdfbfb",
                pattern: "#[0-9a-fA-F]{6}",
                class: "flex-1 px-3 py-2 border border-gray-300 focus:outline-none focus:border-gray-500 transition-colors font-mono",
                style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;",
                id: "background_color_input",
                oninput: "updateColorPreview(this.value)" %>
            <div class="w-10 h-10 rounded border border-gray-300" 
                 style="background-color: <%= @config[:background_color] %>;" 
                 title="現在の背景色"
                 id="color_preview"></div>
          </div>
          <p class="text-xs text-gray-500 mt-1" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 300;">
            #から始まる6桁のカラーコードで入力してください（例: #fdfbfb）
          </p>
        </div>
      </div>
    </section>

    <!-- 保存ボタン -->
    <div class="pt-4 text-right">
      <%= form.submit "設定を保存", 
          class: "text-gray-900 hover:text-gray-600 transition-colors cursor-pointer bg-transparent border-none",
          style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400; text-decoration: underline; text-underline-offset: 4px;" %>
    </div>
  <% end %>

  <!-- 成功メッセージ -->
  <% if flash[:notice] %>
    <div class="mt-6 p-4 bg-green-50 border border-green-200 rounded-md">
      <p class="text-sm text-green-700" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 400;">
        <%= flash[:notice] %>
      </p>
    </div>
  <% end %>

  <!-- エラーメッセージ -->
  <% if flash[:alert] %>
    <div class="mt-6 p-4 bg-red-50 border border-red-200 rounded-md">
      <p class="text-sm text-red-700" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 400;">
        <%= flash[:alert] %>
      </p>
    </div>
  <% end %>
</div>

<script>
function updateColorPreview(color) {
  const preview = document.getElementById('color_preview');
  if (color.match(/^#[0-9a-fA-F]{6}$/)) {
    preview.style.backgroundColor = color;
    preview.style.borderColor = '#d1d5db'; // gray-300
  } else {
    preview.style.backgroundColor = '#f3f4f6'; // gray-100
    preview.style.borderColor = '#ef4444'; // red-500
  }
}
</script>