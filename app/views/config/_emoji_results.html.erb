<% if custom_emojis.any? %>
  <div class="border border-gray-300 overflow-hidden">
    <!-- 一括操作バー -->
    <div class="border-b border-gray-300 px-6 py-3">
      <%= form_with url: bulk_action_config_custom_emojis_path, method: :post, local: true, id: "bulk_form" do |form| %>
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <label class="inline-flex items-center">
              <input type="checkbox" id="select_all" class="custom-checkbox">
              <span class="ml-2 text-sm text-gray-600">すべて選択</span>
            </label>
            
            <div class="flex items-center space-x-2">
              <% if params[:tab] == 'remote' %>
                <%= form.select :action_type, 
                    options_for_select([
                      ['一括操作を選択', ''],
                      ['ローカルにコピー', 'copy'],
                      ['有効化', 'enable'],
                      ['無効化', 'disable'],
                      ['削除', 'delete']
                    ]),
                    {},
                    class: "form-select btn-sm" %>
              <% else %>
                <%= form.select :action_type, 
                    options_for_select([
                      ['一括操作を選択', ''],
                      ['有効化', 'enable'],
                      ['無効化', 'disable'],
                      ['削除', 'delete']
                    ]),
                    {},
                    class: "form-select btn-sm" %>
              <% end %>
              
              <%= form.submit "実行", 
                  class: "btn-secondary btn-sm",
                  onclick: "return confirmBulkAction()" %>
              
              <%= form.hidden_field :tab, value: params[:tab] %>
            </div>
          </div>
          
          <div class="text-sm text-gray-500" >
            <%= defined?(@total_count) ? @total_count : custom_emojis.count %>件の絵文字
            <% if defined?(@current_page) && @total_pages > 1 %>
              （<%= @current_page %>/<%= @total_pages %>ページ）
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 絵文字リスト -->
    <div class="divide-y divide-gray-200">
      <% custom_emojis.each do |emoji| %>
        <div class="px-6 py-4 flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <input type="checkbox" name="emoji_ids[]" value="<%= emoji.id %>" 
                   class="emoji-checkbox custom-checkbox"
                   form="bulk_form">
            
            <div class="flex items-center space-x-3">
              <% if emoji.image.attached? || emoji.image_url.present? %>
                <%= image_tag emoji.url, 
                    alt: ":#{emoji.shortcode}:",
                    class: "w-8 h-8 object-contain",
                    loading: "lazy" %>
              <% else %>
                <div class="w-8 h-8 bg-gray-200 flex items-center justify-center">
                  <span class="text-xs text-gray-500">?</span>
                </div>
              <% end %>
              
              <div>
                <div class="flex items-center space-x-2">
                  <span class="font-mono text-sm">:<%= emoji.shortcode %>:</span>
                  <% if emoji.remote? %>
                    <span class="text-xs text-gray-600"><%= emoji.domain %></span>
                  <% else %>
                    <span class="text-xs text-gray-600">ローカル</span>
                  <% end %>
                  <% unless emoji.disabled %>
                    <span class="text-gray-600 text-xs">有効</span>
                  <% else %>
                    <span class="text-gray-600 text-xs">無効</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <div class="flex items-center space-x-3">
            <!-- 編集アイコン（ローカル絵文字のみ） -->
            <% if emoji.local? %>
              <%= link_to edit_config_custom_emoji_path(emoji), 
                  data: { turbo_frame: "_top" },
                  class: "text-gray-600 hover:text-gray-900 transition-colors",
                  title: "編集" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              <% end %>
            <% else %>
              <!-- リモート絵文字の場合はコピーアイコンを表示 -->
              <%= button_to copy_remote_config_custom_emojis_path, 
                  params: { emoji_ids: [emoji.id] },
                  method: :post,
                  class: "text-gray-600 hover:text-gray-900 transition-colors",
                  title: "ローカルにコピー",
                  form: { style: "display: inline;" },
                  confirm: "絵文字「:#{emoji.shortcode}:」をローカルにコピーしますか？" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
              <% end %>
            <% end %>
            
            <!-- 有効化/無効化アイコン -->
            <% if emoji.disabled %>
              <%= link_to enable_config_custom_emoji_path(emoji), 
                  data: { turbo_method: :patch },
                  class: "text-gray-600 hover:text-gray-900 transition-colors",
                  title: "有効化" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              <% end %>
            <% else %>
              <%= link_to disable_config_custom_emoji_path(emoji), 
                  data: { turbo_method: :patch },
                  class: "text-gray-600 hover:text-gray-900 transition-colors",
                  title: "無効化" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              <% end %>
            <% end %>
            
            <!-- 削除アイコン -->
            <%= link_to config_custom_emoji_path(emoji), 
                data: { 
                  turbo_method: :delete,
                  turbo_confirm: "絵文字「:#{emoji.shortcode}:」を削除しますか？この操作は取り消せません。"
                },
                class: "text-gray-600 hover:text-gray-900 transition-colors",
                title: "削除" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <!-- ページネーション -->
    <% if defined?(@total_pages) && @total_pages > 1 %>
      <div class="border-t border-gray-300 px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <% if @has_prev_page %>
              <%= link_to config_custom_emojis_path(params.to_unsafe_h.merge(page: @current_page - 1)), 
                  class: "px-3 py-1 border border-gray-300 text-gray-900 hover:bg-gray-50 transition-colors text-sm",
                  style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" do %>
                ← 前
              <% end %>
            <% else %>
              <span class="px-3 py-1 border border-gray-200 text-gray-400 text-sm" >← 前</span>
            <% end %>
            
            <span class="px-3 py-1 text-sm text-gray-600" >
              <%= @current_page %> / <%= @total_pages %>
            </span>
            
            <% if @has_next_page %>
              <%= link_to config_custom_emojis_path(params.to_unsafe_h.merge(page: @current_page + 1)), 
                  class: "px-3 py-1 border border-gray-300 text-gray-900 hover:bg-gray-50 transition-colors text-sm",
                  style: "font-family: 'Noto Sans JP', sans-serif; font-weight: 400;" do %>
                次 →
              <% end %>
            <% else %>
              <span class="px-3 py-1 border border-gray-200 text-gray-400 text-sm" >次 →</span>
            <% end %>
          </div>
          
          <div class="text-sm text-gray-500" >
            <%= (@current_page - 1) * 20 + 1 %>-<%= [@current_page * 20, @total_count].min %> 件目 / 全<%= @total_count %>件
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- 空状態 -->
  <div class="text-center py-12">
    <p class="text-sm text-gray-500" style="font-family: 'Noto Sans JP', sans-serif; font-weight: 300;">
      該当なし
    </p>
  </div>
<% end %>